<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parent Page with Popup</title>
</head>
<body>
  <h1>Parent Page</h1>
  <button id="open-popup">Open Calendar Popup</button>

  <script>
    const winPrefs = "width=400,height=300,resizable=no,scrollbars=no,toolbar=no,location=no,status=no,menubar=no";

    document.getElementById("open-popup").addEventListener("click", function () {
      // Check if popup already exists and reopen
      if (top.newWin && !top.newWin.closed) {
        // Attempt to update the content using `javascript:` URL
        top.newWin.location = "javascript:parent.opener.injectCalendar()";
        top.newWin.focus();
        return false;
      }

      // Open a new popup with `javascript:` URL and attempt calendar injection
      top.newWin = window.open("javascript:parent.opener.injectCalendar()", "calWin", winPrefs);
      top.newWin.focus();
    });

    // Function to inject calendar content into the popup
    window.injectCalendar = function () {
      const popupDocument = window.newWin.document;
      popupDocument.open();
      popupDocument.write(`
        <!DOCTYPE html>
        <html lang="en">
        <head>
          <title>Calendar Popup</title>
          <style>
            body {
              margin: 0;
              font-family: Arial, sans-serif;
              display: flex;
              justify-content: center;
              align-items: center;
              height: 100vh;
            }
            #calendar {
              font-size: 20px;
            }
          </style>
        </head>
        <body>
          <h1>Select a Date</h1>
          <input type="date" id="calendar">
        </body>
        </html>
      `);
      popupDocument.close();
    };
  </script>
</body>
</html>
